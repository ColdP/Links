<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文字评析系统</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Material Symbols CDN -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Symbols+Outlined" rel="stylesheet">
    <!-- Google Fonts - Inter (Used as a visually similar alternative to Google Sans/Product Sans) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Define base color variables (default to blue light theme) */
        :root {
            /* Material 3 Expressive Palette 1: Blue (Default) - Less Saturated */
            --blue-primary: #0060A8; --blue-on-primary: #FFFFFF; --blue-primary-light: #5296E0; --blue-primary-dark: #004780;
            --blue-secondary-container: #D1E4FF; --blue-on-secondary-container: #001B3B;
            /* Material 3 Expressive Palette 2: Green - Less Saturated */
            --green-primary: #386A20; --green-on-primary: #FFFFFF; --green-primary-light: #7E9C68; --green-primary-dark: #274D16;
            --green-secondary-container: #C3EFB4; --green-on-secondary-container: #0B2100;
            /* Material 3 Expressive Palette 3: Purple - Less Saturated */
            --purple-primary: #6B4E99; --purple-on-primary: #FFFFFF; --purple-primary-light: #C0A9DD; --purple-primary-dark: #503A72;
            --purple-secondary-container: #EADDFF; --purple-on-secondary-container: #250059;
            /* Material 3 Expressive Palette 4: Orange - Less Saturated */
            --orange-primary: #9E432A; --orange-on-primary: #FFFFFF; --orange-primary-light: #E48D6C; --orange-primary-dark: #78321F;
            --orange-secondary-container: #FFDBCF; --orange-on-secondary-container: #3F0600;

            --neutral: #49454f;
            --on-neutral: #FFFFFF; /* For text on neutral background */
            --surface: #F7FBFC;
            --on-surface: #1A1C1E;
            --surface-container: #FFFFFF; /* Light mode card background */
            --border: #79747e;
            --error: #ba1a1a;
            --on-error-container: #ffdad6;

            /* Current active colors - these will be dynamically updated based on dark mode and selected theme */
            --current-primary: var(--blue-primary);
            --current-on-primary: var(--blue-on-primary);
            --current-primary-light: var(--blue-primary-light);
            --current-primary-dark: var(--blue-primary-dark);
            --current-secondary-container: var(--blue-secondary-container);
            --current-on-secondary-container: var(--blue-on-secondary-container);
            --current-neutral: var(--neutral);
            --current-on-neutral: var(--on-neutral);
            --current-surface: var(--surface);
            --current-on-surface: var(--on-surface);
            --current-surface-container: var(--surface-container); /* Apply to cards */
            --current-border: var(--border);
            --current-error: var(--error);
            --current-on-error-container: var(--on-error-container);
        }

        /* Dark mode overrides */
        body.dark-mode {
            /* Material 3 Expressive Palette 1: Blue (Dark) - Adjusted for lower saturation */
            --blue-primary: #7DA5CC; --blue-on-primary: #002545; --blue-primary-light: #B8D3EB; --blue-primary-dark: #457BA5;
            --blue-secondary-container: #003666; --blue-on-secondary-container: #C5E0F5;
            /* Material 3 Expressive Palette 2: Green (Dark) - Adjusted for lower saturation */
            --green-primary: #8CC078; --green-on-primary: #122900; --green-primary-light: #C7E0B9; --green-primary-dark: #5A8D3F;
            --green-secondary-container: #1D3A00; --green-on-secondary-container: #B7E2A6;
            /* Material 3 Expressive Palette 3: Purple (Dark) - Adjusted for lower saturation */
            --purple-primary: #BCA1D0; --purple-on-primary: #2B1647; --purple-primary-light: #E0CCF0; --purple-primary-dark: #8F79A5;
            --purple-secondary-container: #3B2A5F; --purple-on-secondary-container: #D9C3EC;
            /* Material 3 Expressive Palette 4: Orange (Dark) - Adjusted for lower saturation */
            --orange-primary: #D99F87; --orange-on-primary: #471100; --orange-primary-light: #EBBAB0; --orange-primary-dark: #A55A44;
            --orange-secondary-container: #5C2200; --orange-on-secondary-container: #E0C8BC;

            /* Neutral and Surface Colors for Dark Mode (Softer) */
            --current-neutral: #B7B7B5; /* Softer light grey for neutral text */
            --current-on-neutral: #1A1C1E; /* Dark text on neutral background in dark mode */
            --current-surface: #121314; /* Dark surface */
            --current-on-surface: #CFCFCD; /* Softer light text on dark surface */
            --current-surface-container: #222224; /* Dark mode card background - adjusted for contrast */
            --current-border: #928F95; /* Lighter border for dark mode */
            --current-error: #FFB4AB;
            --current-on-error-container: #690005;
        }

        /* Apply current variables to elements */
        body {
            font-family: 'Inter', sans-serif; /* Applied 'Inter' font */
            background-color: var(--current-surface); /* Background uses current surface color */
            color: var(--current-on-surface); /* Text color uses current on-surface color */
            margin: 0;
            padding: 4rem 2rem;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth transition for dark mode */
        }

        .content-wrapper {
            max-width: 960px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        h1 {
            color: var(--current-primary); /* Heading color */
            transition: color 0.3s ease;
        }

        .input-group label {
            font-weight: 500;
            color: var(--current-neutral); /* Label color */
            margin-bottom: 0.5rem;
            transition: color 0.3s ease;
        }
        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--current-border); /* Input border color */
            border-radius: 16px;
            background-color: var(--current-surface-container); /* Inputs have a surface-container background */
            color: var(--current-on-surface); /* Input text color */
            transition: border-color 0.2s, box-shadow 0.2s, background-color 0.3s ease, color 0.3s ease;
        }
        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--current-primary); /* Focus border color */
            box-shadow: 0 0 0 2px var(--current-primary-light); /* Focus ring color */
        }

        /* Custom Scrollbar for Webkit browsers (Chrome, Safari) */
        .input-group textarea::-webkit-scrollbar {
            width: 10px; /* Width of the vertical scrollbar */
            border-radius: 5px; /* Rounded corners for the scrollbar track */
        }

        .input-group textarea::-webkit-scrollbar-track {
            background: var(--current-secondary-container); /* Color of the track */
            border-radius: 5px;
        }

        .input-group textarea::-webkit-scrollbar-thumb {
            background: var(--current-primary); /* Color of the scrollbar thumb */
            border-radius: 5px; /* Rounded corners for the thumb */
            border: 2px solid var(--current-surface-container); /* Border to give it space from track */
        }

        /* Hover effect on thumb */
        .input-group textarea::-webkit-scrollbar-thumb:hover {
            background: var(--current-primary-dark); /* Darker on hover */
        }


        .submit-button {
            background-color: var(--current-primary); /* Button background */
            color: var(--current-on-primary); /* Button text color */
            padding: 1rem 2rem;
            border-radius: 20px;
            font-size: 1.125rem;
            font-weight: 500;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s cubic-bezier(0.2, 0.0, 0, 1), box-shadow 0.2s cubic-bezier(0.2, 0.0, 0, 1), color 0.3s ease; /* Enhanced transition */
        }
        .submit-button:hover {
            background-color: var(--current-primary-dark); /* Button hover background */
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.15);
        }
        .results-section {
            background-color: var(--current-surface-container); /* Results section background uses surface-container */
            padding: 2rem;
            border-radius: 28px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.08);
            margin-top: 1rem;
            transition: background-color 0.3s ease;
        }
        .score-display {
            font-size: 3rem;
            font-weight: 700;
            color: var(--current-primary); /* Score color */
            text-align: center;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
        }
        .aspect-score {
            display: flex;
            flex-direction: column; /* Stack info row and progress bar row vertically */
            padding: 0.75rem 0;
            border-bottom: 1px dashed color-mix(in srgb, var(--current-neutral) 30%, transparent);
        }
        .aspect-score:last-child {
            border-bottom: none;
        }

        .aspect-info { /* This is the top row: label + score */
            display: flex;
            justify-content: space-between; /* Push label left, score right */
            align-items: baseline; /* Align text baselines */
            width: 100%; /* Make it span full width of aspect-score */
            margin-bottom: 0.25rem; /* Space between info and progress bar */
        }

        .aspect-label { /* The text label */
            font-weight: 500;
            color: var(--current-neutral);
            transition: color 0.3s ease;
        }

        .aspect-value { /* The score number */
            font-weight: 600;
            color: var(--current-on-surface);
            transition: color 0.3s ease;
        }

        .progress-bar-area { /* Container for the progress bar */
            width: 100%; /* Make it span full width of aspect-score */
        }

        /* Progress Bar Styles */
        .progress-bar-background {
            width: 100%;
            height: 8px; /* Height of the progress bar */
            background-color: var(--current-secondary-container); /* Background of the bar */
            border-radius: 4px; /* Rounded corners for the background */
            overflow: hidden; /* Hide overflow of the fill */
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%; /* Initial width for animation */
            background-color: var(--current-primary); /* Fill color */
            border-radius: 4px; /* Rounded corners for the fill */
            transition: width 0.8s cubic-bezier(0.4, 0.0, 0.2, 1); /* Material 3-like cubic-bezier for expressive motion */
        }

        .analysis-text {
            line-height: 1.6;
            background-color: var(--current-secondary-container); /* Analysis box background */
            padding: 1rem;
            border-radius: 0.75rem; /* Match radio group for consistency */
            transition: background-color 0.3s ease, color 0.3s ease;
            color: var(--current-neutral); /* Default color for analysis text (light mode) */
        }
        /* Specific overrides for analysis-text in dark mode */
        body.dark-mode .analysis-text {
            color: #FFFFFF; /* Pure white in dark mode */
            background-color: #1A1A1A; /* Darker background in dark mode */
        }
        /* Basic rich text styling for AI-generated content (if it includes HTML tags) */
        .analysis-text h1, .analysis-text h2, .analysis-text h3 {
            color: inherit; /* Inherit from .analysis-text */
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-weight: bold;
        }
        .analysis-text h1 { font-size: 1.5em; }
        .analysis-text h2 { font-size: 1.3em; }
        .analysis-text h3 { font-size: 1.1em; }
        .analysis-text p {
            color: inherit; /* Inherit from .analysis-text */
            margin-bottom: 1em;
        }
        .analysis-text ul, .analysis-text ol {
            color: inherit; /* Inherit from .analysis-text */
            margin-left: 1.5em;
            margin-bottom: 1em;
            list-style-type: disc;
        }
        .analysis-text ol {
            list-style-type: decimal;
        }
        .analysis-text strong {
            color: inherit; /* Inherit from .analysis-text */
            font-weight: bold;
        }
        .analysis-text em {
            color: inherit; /* Inherit from .analysis-text */
            font-style: italic;
        }


        .loading-spinner {
            border: 4px solid color-mix(in srgb, var(--current-surface) 50%, transparent);
            border-top: 4px solid var(--current-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
            display: none;
            transition: border-top-color 0.3s ease;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            color: var(--current-error);
            background-color: var(--current-on-error-container);
            padding: 1rem;
            border-radius: 12px;
            margin-top: 1rem;
            display: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Top controls for dark/light mode toggle and theme palette */
        .top-controls {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-bottom: 1.5rem;
            width: 100%;
            max-width: 960px; /* Align with content-wrapper */
            align-items: center; /* Vertically align items */
        }
        .control-button {
            background-color: var(--current-secondary-container);
            color: var(--current-on-secondary-container);
            padding: 0.75rem; /* Adjusted padding for icon only */
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center; /* Center icon */
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s cubic-bezier(0.2, 0.0, 0, 1), color 0.2s cubic-bezier(0.2, 0.0, 0, 1), box-shadow 0.2s cubic-bezier(0.2, 0.0, 0, 1);
        }
        .control-button:hover {
            background-color: color-mix(in srgb, var(--current-secondary-container) 90%, black);
        }
        .control-button .material-symbols-outlined {
            font-size: 1.5rem;
        }
        /* Custom styles for select dropdown to match Material 3 Expressive */
        .mode-select-wrapper {
            position: relative; /* For custom arrow positioning */
            width: 100%; /* Ensure it takes full width from parent */
        }
        .mode-select {
            -webkit-appearance: none; /* Remove default styling for Chrome/Safari */
            -moz-appearance: none; /* Remove default styling for Firefox */
            appearance: none; /* Remove default styling for all browsers */
            width: 100%; /* Ensure it fills the wrapper */
            padding: 1rem;
            padding-right: 2.5rem; /* Space for custom arrow */
            border: 1px solid var(--current-border);
            border-radius: 16px;
            background-color: var(--current-surface-container);
            color: var(--current-on-surface);
            cursor: pointer;
            font-size: 1rem; /* Consistent font size */
            line-height: 1.5; /* Consistent line height */
            
            /* Custom dropdown arrow SVG: dark arrow for light mode */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="%2349454f"><path d="M7 10l5 5 5-5z"/></svg>'); 
            background-repeat: no-repeat;
            background-position: right 0.75rem center; /* Position the arrow */
            background-size: 1.5rem; /* Size the arrow */
            
            /* Apply Material 3 Expressive motion to select element itself */
            transition: border-color 0.2s cubic-bezier(0.4, 0.0, 0.2, 1), 
                        box-shadow 0.2s cubic-bezier(0.4, 0.0, 0.2, 1), 
                        background-color 0.2s cubic-bezier(0.2, 0.0, 0, 1), /* Faster transition for background */
                        color 0.3s ease;
        }
        body.dark-mode .mode-select {
            /* Custom dropdown arrow SVG: light arrow for dark mode (adjusted to better contrast with darker background) */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="%23CFCFCD"><path d="M7 10l5 5 5-5z"/></svg>'); 
        }
        /* Hover state for custom select */
        .mode-select:hover {
            background-color: color-mix(in srgb, var(--current-surface-container) 90%, black); /* Slightly darker on hover */
        }
        /* Focus state for custom select */
        .mode-select:focus {
            outline: none; /* Remove default focus outline */
            border-color: var(--current-primary); /* Focus border color */
            box-shadow: 0 0 0 2px var(--current-primary-light); /* Focus ring color */
        }

        /* Color Palette Styles */
        .color-palette {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-right: 1rem; /* Space between palette and dark mode toggle */
        }
        .color-swatch {
            width: 24px;
            height: 24px;
            border-radius: 50%; /* Circular swatches */
            cursor: pointer;
            border: 2px solid transparent; /* Default transparent border */
            box-shadow: 0px 1px 2px rgba(0,0,0,0.1);
            transition: transform 0.2s cubic-bezier(0.4, 0.0, 0.2, 1), border-color 0.2s ease;
        }
        .color-swatch:hover {
            transform: scale(1.1);
        }
        .color-swatch.selected {
            border-color: var(--current-neutral); /* Highlight selected swatch */
            box-shadow: 0px 2px 4px rgba(0,0,0,0.2);
            transform: scale(1.1);
        }

        /* Strict Mode Switch Styles (Tailwind custom styling) */
        /* Group the switch label with the analysis mode select */
        .analysis-mode-group .strict-mode-switch {
            margin-top: 1.5rem; /* Space between select and switch */
            padding-top: 1.5rem;
            border-top: 1px dashed color-mix(in srgb, var(--current-neutral) 10%, transparent); /* Subtle separator */
        }

        .strict-mode-switch .switch-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            width: fit-content; /* Adjust width to content */
        }

        .strict-mode-switch .toggle-input {
            /* Hide default checkbox */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            display: inline-block; /* Keep it in the flow for peer selector */
            position: relative;
            width: 38px; /* Width of the track */
            height: 20px; /* Height of the track */
            background-color: var(--current-border); /* Inactive track color */
            border-radius: 9999px; /* Fully rounded */
            transition: background-color 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            flex-shrink: 0; /* Prevent it from shrinking */
        }

        .strict-mode-switch .toggle-input::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px; /* Diameter of the thumb */
            height: 16px; /* Diameter of the thumb */
            background-color: var(--current-on-neutral); /* Thumb color */
            border-radius: 9999px; /* Fully rounded */
            transform: translateX(0);
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            box-shadow: 0px 1px 2px rgba(0,0,0,0.2);
        }

        .strict-mode-switch .toggle-input:checked {
            background-color: var(--current-primary); /* Active track color */
        }

        .strict-mode-switch .toggle-input:checked::before {
            transform: translateX(18px); /* Move thumb to the right (38px - 16px - 2*2px_padding = 18px) */
            background-color: var(--current-on-primary); /* Active thumb color */
        }

        .strict-mode-switch .toggle-text {
            margin-left: 0.75rem; /* Space between switch and text */
            font-size: 1rem;
            color: var(--current-neutral);
            transition: color 0.3s ease;
        }

        /* Focus ring for switch */
        .strict-mode-switch .toggle-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px var(--current-primary-light);
        }

    </style>
</head>
<body>
    <div class="content-wrapper">
        <!-- Top Controls -->
        <div class="top-controls">
            <!-- Color Palette -->
            <div class="color-palette">
                <button class="color-swatch" style="background-color: #0060A8;" data-theme="blue" title="蓝主题"></button>
                <button class="color-swatch" style="background-color: #386A20;" data-theme="green" title="绿主题"></button>
                <button class="color-swatch" style="background-color: #6B4E99;" data-theme="purple" title="紫主题"></button>
                <button class="color-swatch" style="background-color: #9E432A;" data-theme="orange" title="橙主题"></button>
            </div>
            <button id="darkModeToggle" class="control-button">
                <span id="darkModeIcon" class="material-symbols-outlined">light_mode</span>
            </button>
        </div>

        <h1 class="text-4xl font-bold text-center mb-4">文字评析系统</h1>

        <!-- Input Section -->
        <div class="input-group surface-container-bg p-6 rounded-2xl shadow-md">
            <label for="title" class="block text-lg mb-2">文本标题 (可选):</label>
            <input type="text" id="title" class="w-full" placeholder="输入文本标题">
        </div>
        <div class="input-group surface-container-bg p-6 rounded-2xl shadow-md">
            <label for="content" class="block text-lg mb-2">文本正文 <span class="text-red-500">*</span>:</label>
            <textarea id="content" rows="10" class="w-full resize-y" placeholder="输入您想要评析的文本正文..."></textarea>
        </div>

        <!-- Analysis Mode Selection and Strict Mode Toggle -->
        <div class="analysis-mode-group surface-container-bg p-6 rounded-2xl shadow-md">
            <label for="analysisModeSelect" class="block text-lg font-medium mb-2">选择评语模式:</label>
            <div class="mode-select-wrapper">
                <select id="analysisModeSelect" class="w-full mode-select">
                    <option value="short">简短 (一句话)</option>
                    <option value="medium" selected>中等长度 (~100字)</option>
                    <option value="long">较长解析 (~500字)</option>
                    <option value="essay">论文模式 (详细)</option>
                </select>
            </div>

            <!-- Strict Mode Toggle (Moved inside this card) -->
            <div class="strict-mode-switch">
                <label class="switch-label">
                    <input type="checkbox" id="strictModeToggle" class="toggle-input">
                    <span class="toggle-text">严格模式</span>
                </label>
            </div>
        </div>

        <button id="submitBtn" class="submit-button self-center">开始评析</button>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner"></div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message"></div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section hidden">
            <h2 class="text-2xl font-bold mb-4 text-center">评析结果</h2>

            <!-- Overall Score -->
            <div>
                <p class="text-lg text-center mb-2">综合评分 (满分100):</p>
                <p id="overallScore" class="score-display">--</p>
            </div>

            <!-- Aspect Scores -->
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-3">各维度评分:</h3>
                <div class="flex flex-col gap-2">
                    <div class="aspect-score">
                        <div class="aspect-info">
                            <span class="aspect-label">意象/感官细节:</span>
                            <span class="aspect-value" id="scoreImagery">--</span>
                        </div>
                        <div class="progress-bar-area">
                            <div class="progress-bar-background">
                                <div id="progressImagery" class="progress-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                    <div class="aspect-score">
                        <div class="aspect-info">
                            <span class="aspect-label">情感深度/氛围:</span>
                            <span class="aspect-value" id="scoreEmotional">--</span>
                        </div>
                        <div class="progress-bar-area">
                            <div class="progress-bar-background">
                                <div id="progressEmotional" class="progress-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                    <div class="aspect-score">
                        <div class="aspect-info">
                            <span class="aspect-label">修辞/风格:</span>
                            <span class="aspect-value" id="scoreFigurative">--</span>
                        </div>
                        <div class="progress-bar-area">
                            <div class="progress-bar-background">
                                <div id="progressFigurative" class="progress-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                    <div class="aspect-score">
                        <div class="aspect-info">
                            <span class="aspect-label">叙事流畅性/连贯性:</span>
                            <span class="aspect-value" id="scoreNarrative">--</span>
                        </div>
                        <div class="progress-bar-area">
                            <div class="progress-bar-background">
                                <div id="progressNarrative" class="progress-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                    <div class="aspect-score">
                        <div class="aspect-info">
                            <span class="aspect-label">原创性/冲击力:</span>
                            <span class="aspect-value" id="scoreOriginality">--</span>
                        </div>
                        <div class="progress-bar-area">
                            <div class="progress-bar-background">
                                <div id="progressOriginality" class="progress-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                    <!-- AI Rate -->
                    <div class="aspect-score">
                        <div class="aspect-info">
                            <span class="aspect-label">AI 率:</span>
                            <span class="aspect-value" id="scoreAIRate">--</span>
                        </div>
                        <div class="progress-bar-area">
                            <div class="progress-bar-background">
                                <div id="progressAIRate" class="progress-bar-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Text -->
            <div>
                <h3 class="text-xl font-semibold mb-3">评析内容:</h3>
                <div id="analysisContent" class="analysis-text">
                    <!-- Analysis will be injected here -->
                </div>
            </div>
        </div>
    </div>
    <script>
        // DOM Elements
        const titleInput = document.getElementById('title');
        const contentInput = document.getElementById('content');
        const analysisModeSelect = document.getElementById('analysisModeSelect');
        const submitBtn = document.getElementById('submitBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const errorMessage = document.getElementById('errorMessage');
        const resultsSection = document.getElementById('resultsSection');
        const overallScoreElem = document.getElementById('overallScore');
        const scoreImageryElem = document.getElementById('scoreImagery');
        const scoreEmotionalElem = document.getElementById('scoreEmotional');
        const scoreFigurativeElem = document.getElementById('scoreFigurative');
        const scoreNarrativeElem = document.getElementById('scoreNarrative');
        const scoreOriginalityElem = document.getElementById('scoreOriginality');
        const scoreAIRateElem = document.getElementById('scoreAIRate');
        const analysisContentElem = document.getElementById('analysisContent');

        // Progress bar elements
        const progressImageryElem = document.getElementById('progressImagery');
        const progressEmotionalElem = document.getElementById('progressEmotional');
        const progressFigurativeElem = document.getElementById('progressFigurative');
        const progressNarrativeElem = document.getElementById('progressNarrative');
        const progressOriginalityElem = document.getElementById('progressOriginality');
        const progressAIRateElem = document.getElementById('progressAIRate');

        const darkModeToggle = document.getElementById('darkModeToggle');
        const darkModeIcon = document.getElementById('darkModeIcon');
        const colorSwatches = document.querySelectorAll('.color-swatch'); // Color palette swatches
        const strictModeToggle = document.getElementById('strictModeToggle'); // Strict mode switch

        // Gemini API Key (provided by user)
        const apiKey = "AIzaSyALvO3HMppp4OKWja1A96gLgiYTpHsvLJI";

        // Define color themes (updated with more muted M3-like tones and adjusted dark modes)
        const allThemes = {
            blue: {
                light: {
                    primary: '#0060A8', onPrimary: '#FFFFFF', primaryLight: '#5296E0', primaryDark: '#004780',
                    secondaryContainer: '#D1E4FF', onSecondaryContainer: '#001B3B',
                },
                dark: {
                    primary: '#7DA5CC', onPrimary: '#002545', primaryLight: '#B8D3EB', primaryDark: '#457BA5',
                    secondaryContainer: '#003666', onSecondaryContainer: '#C5E0F5',
                }
            },
            green: {
                light: {
                    primary: '#386A20', onPrimary: '#FFFFFF', primaryLight: '#7E9C68', primaryDark: '#274D16',
                    secondaryContainer: '#C3EFB4', onSecondaryContainer: '#0B2100',
                },
                dark: {
                    primary: '#8CC078', onPrimary: '#122900', primaryLight: '#C7E0B9', primaryDark: '#5A8D3F',
                    secondaryContainer: '#1D3A00', onSecondaryContainer: '#B7E2A6',
                }
            },
            purple: {
                light: {
                    primary: '#6B4E99', onPrimary: '#FFFFFF', primaryLight: '#C0A9DD', primaryDark: '#503A72',
                    secondaryContainer: '#EADDFF', onSecondaryContainer: '#250059',
                },
                dark: {
                    primary: '#BCA1D0', onPrimary: '#2B1647', primaryLight: '#E0CCF0', primaryDark: '#8F79A5',
                    secondaryContainer: '#3B2A5F', onSecondaryContainer: '#D9C3EC',
                }
            },
            orange: {
                light: {
                    primary: '#9E432A', onPrimary: '#FFFFFF', primaryLight: '#E48D6C', primaryDark: '#78321F',
                    secondaryContainer: '#FFDBCF', onSecondaryContainer: '#3F0600',
                },
                dark: {
                    primary: '#D99F87', onPrimary: '#471100', primaryLight: '#EBBAB0', primaryDark: '#A55A44',
                    secondaryContainer: '#5C2200', onSecondaryContainer: '#E0C8BC',
                }
            }
        };

        let currentBaseTheme = localStorage.getItem('selectedTheme') || 'blue'; // Default to 'blue'

        /**
         * Applies the selected theme colors to the CSS variables.
         * @param {boolean} isDarkMode - Whether to apply dark mode specific colors.
         */
        function applyTheme(isDarkMode) {
            const themeColors = allThemes[currentBaseTheme][isDarkMode ? 'dark' : 'light'];
            for (const [key, value] of Object.entries(themeColors)) {
                document.documentElement.style.setProperty(`--current-${key}`, value);
            }
            // Apply neutral and surface colors which are independent of base theme but depend on dark mode
            const neutralColors = isDarkMode ? { neutral: '#B7B7B5', onNeutral: '#1A1C1E', surface: '#121314', onSurface: '#CFCFCD', surfaceContainer: '#222224', border: '#928F95', error: '#FFB4AB', onErrorContainer: '#690005' } :
                                  { neutral: '#49454f', onNeutral: '#FFFFFF', surface: '#F7FBFC', onSurface: '#1A1C1E', surfaceContainer: '#FFFFFF', border: '#79747e', error: '#ba1a1a', onErrorContainer: '#ffdad6' };
            for (const [key, value] of Object.entries(neutralColors)) {
                document.documentElement.style.setProperty(`--current-${key}`, value);
            }
            updateSelectedSwatch(); // Update active swatch
        }

        /**
         * Toggles between light and dark mode.
         */
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            updateDarkModeToggleButton(isDarkMode);
            applyTheme(isDarkMode); // Re-apply theme to pick up correct dark/light colors
        }

        /**
         * Updates the dark mode toggle button icon and text.
         * @param {boolean} isDarkMode - True if dark mode is active, false otherwise.
         */
        function updateDarkModeToggleButton(isDarkMode) {
            if (isDarkMode) {
                darkModeIcon.textContent = 'dark_mode';
            } else {
                darkModeIcon.textContent = 'light_mode';
            }
        }

        /**
         * Updates the visual state of the selected color swatch.
         */
        function updateSelectedSwatch() {
            colorSwatches.forEach(swatch => {
                if (swatch.dataset.theme === currentBaseTheme) {
                    swatch.classList.add('selected');
                } else {
                    swatch.classList.remove('selected');
                }
            });
        }

        /**
         * Initializes theme and dark mode from localStorage.
         */
        function initializeThemeAndDarkMode() {
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            currentBaseTheme = localStorage.getItem('selectedTheme') || 'blue'; // Default to 'blue'
            const savedStrictMode = localStorage.getItem('strictMode') === 'true';

            if (savedDarkMode) {
                document.body.classList.add('dark-mode');
            }
            updateDarkModeToggleButton(savedDarkMode);
            applyTheme(savedDarkMode); // Apply initial theme colors
            strictModeToggle.checked = savedStrictMode; // Set strict mode toggle state
        }

        /**
         * Clears previous results and error messages, and hides the results section.
         * Also resets progress bars.
         */
        function clearResults() {
            overallScoreElem.textContent = '--';
            scoreImageryElem.textContent = '--';
            scoreEmotionalElem.textContent = '--';
            scoreFigurativeElem.textContent = '--';
            scoreNarrativeElem.textContent = '--';
            scoreOriginalityElem.textContent = '--';
            scoreAIRateElem.textContent = '--'; // Clear AI Rate

            // Reset progress bars to 0% for animation
            progressImageryElem.style.width = '0%';
            progressEmotionalElem.style.width = '0%';
            progressFigurativeElem.style.width = '0%';
            progressNarrativeElem.style.width = '0%';
            progressOriginalityElem.style.width = '0%';
            progressAIRateElem.style.width = '0%';

            errorMessage.style.display = 'none';
            resultsSection.classList.add('hidden');
        }

        /**
         * Handles the submission of the text for analysis.
         * Fetches scores and analysis from the Gemini API.
         */
        async function rateText() {
            clearResults(); // Clear previous results
            const title = titleInput.value.trim();
            const content = contentInput.value.trim();
            let selectedMode = analysisModeSelect.value;
            const isStrictMode = strictModeToggle.checked; // Get strict mode state
            let modeText = '';

            if (!content) {
                errorMessage.textContent = '文本正文不能为空！';
                errorMessage.style.display = 'block';
                return;
            }

            // Determine mode text for the prompt
            switch (selectedMode) {
                case 'short':
                    modeText = '简短模式（一句话）';
                    break;
                case 'medium':
                    modeText = '中等长度模式（约100字）';
                    break;
                case 'long':
                    modeText = '较长解析模式（约500字）';
                    break;
                case 'essay':
                    modeText = '论文模式（详细、深度，约1000字）';
                    break;
                default:
                    modeText = '简短模式（一句话）';
            }

            // Show loading spinner
            loadingSpinner.style.display = 'block';
            submitBtn.disabled = true; // Disable button during processing

            try {
                // Construct the prompt for the Gemini API
                let promptInstructions = `
请对以下文本进行评析，并从其意象/感官细节、情感深度/氛围、修辞/风格、叙事流畅性/连贯性、原创性/冲击力这五个维度给出0-100分的评分。同时，**请评估文本的“AI 率”，即文本内容由AI生成的可能性，给出0-100的评分和相应的百分比（例如：“80%”）。**

`;
                if (isStrictMode) {
                    promptInstructions += `**请在评分和评析时非常严格和批判，指出所有不足之处，即使分数可能较低。**`;
                } else {
                    promptInstructions += `**请在评分时极其宽松和鼓励，给出相对较高的分数，并高度肯定文本的优点和潜力。在生成评析内容时，请使用极其积极、支持性的语言，提供非常有建设性的反馈，并确保评析内容能够最大限度地激发作者的创作热情和自信。**`;
                }

                promptInstructions += `**请不要在评析内容中使用任何Markdown格式，直接生成纯HTML格式的内容，包括使用例如 <p>、<strong>、<em>、<ul>、<ol>、<li> 等标准的HTML标签进行排版。**

请严格按照以下JSON Schema返回结果：
{
    "overallScore": { "type": "NUMBER", "description": "总评分，0-100" },
    "aspectScores": {
        "type": "OBJECT",
        "properties": {
            "imagerySensoryDetail": { "type": "NUMBER", "description": "意象/感官细节评分" },
            "emotionalDepthAtmosphere": { "type": "NUMBER", "description": "情感深度/氛围评分" },
            "figurativeLanguageStyle": { "type": "NUMBER", "description": "修辞/风格评分" },
            "narrativeFlowCohesion": { "type": "NUMBER", "description": "叙事流畅性/连贯性评分" },
            "originalityImpact": { "type": "NUMBER", "description": "原创性/冲击力评分" },
            "aiRate": { "type": "NUMBER", "description": "AI率评分，0-100" }
        },
        "required": [
            "imagerySensoryDetail",
            "emotionalDepthAtmosphere",
            "figurativeLanguageStyle",
            "narrativeFlowCohesion",
            "originalityImpact",
            "aiRate"
        ]
    },
    "analysis": { "type": "STRING", "description": "根据所选模式生成的评析内容，应包含HTML格式" }
}

**文本标题 (可选):** ${title ? title : '无标题'}
**文本正文:**
${content}

**评语模式:** ${modeText}
                `;

                // Define the payload for the Gemini API request
                const chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: promptInstructions }] }); // Use the constructed prompt
                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "overallScore": { "type": "NUMBER" },
                                "aspectScores": {
                                    "type": "OBJECT",
                                    "properties": {
                                        "imagerySensoryDetail": { "type": "NUMBER" },
                                        "emotionalDepthAtmosphere": { "type": "NUMBER" },
                                        "figurativeLanguageStyle": { "type": "NUMBER" },
                                        "narrativeFlowCohesion": { "type": "NUMBER" },
                                        "originalityImpact": { "type": "NUMBER" },
                                        "aiRate": { "type": "NUMBER" }
                                    },
                                    "required": [
                                        "imagerySensoryDetail",
                                        "emotionalDepthAtmosphere",
                                        "figurativeLanguageStyle",
                                        "narrativeFlowCohesion",
                                        "originalityImpact",
                                        "aiRate"
                                    ]
                                },
                                "analysis": { "type": "STRING" }
                            },
                            "required": ["overallScore", "aspectScores", "analysis"]
                        }
                    }
                };

                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API error: ${response.status} ${response.statusText} - ${errorData.error.message || 'Unknown error'}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const jsonString = result.candidates[0].content.parts[0].text;
                    const parsedData = JSON.parse(jsonString);

                    // Update UI with results
                    overallScoreElem.textContent = parsedData.overallScore !== undefined ? parsedData.overallScore.toFixed(0) : '--';
                    if (parsedData.aspectScores) {
                        // Update text scores
                        scoreImageryElem.textContent = parsedData.aspectScores.imagerySensoryDetail !== undefined ? parsedData.aspectScores.imagerySensoryDetail.toFixed(0) : '--';
                        scoreEmotionalElem.textContent = parsedData.aspectScores.emotionalDepthAtmosphere !== undefined ? parsedData.aspectScores.emotionalDepthAtmosphere.toFixed(0) : '--';
                        scoreFigurativeElem.textContent = parsedData.aspectScores.figurativeLanguageStyle !== undefined ? parsedData.aspectScores.figurativeLanguageStyle.toFixed(0) : '--';
                        scoreNarrativeElem.textContent = parsedData.aspectScores.narrativeFlowCohesion !== undefined ? parsedData.aspectScores.narrativeFlowCohesion.toFixed(0) : '--';
                        scoreOriginalityElem.textContent = parsedData.aspectScores.originalityImpact !== undefined ? parsedData.aspectScores.originalityImpact.toFixed(0) : '--';
                        scoreAIRateElem.textContent = parsedData.aspectScores.aiRate !== undefined ? `${parsedData.aspectScores.aiRate.toFixed(0)}%` : '--';

                        // Set progress bar widths to trigger animation
                        setTimeout(() => {
                            progressImageryElem.style.width = `${parsedData.aspectScores.imagerySensoryDetail || 0}%`;
                            progressEmotionalElem.style.width = `${parsedData.aspectScores.emotionalDepthAtmosphere || 0}%`;
                            progressFigurativeElem.style.width = `${parsedData.aspectScores.figurativeLanguageStyle || 0}%`;
                            progressNarrativeElem.style.width = `${parsedData.aspectScores.narrativeFlowCohesion || 0}%`;
                            progressOriginalityElem.style.width = `${parsedData.aspectScores.originalityImpact || 0}%`;
                            progressAIRateElem.style.width = `${parsedData.aspectScores.aiRate || 0}%`;
                        }, 100);
                    }
                    // Directly set innerHTML for rich text display (no Markdown parsing)
                    analysisContentElem.innerHTML = parsedData.analysis || '未能生成评析内容。';
                    resultsSection.classList.remove('hidden');

                } else {
                    throw new Error('API响应结构异常或内容缺失。');
                }

            } catch (error) {
                console.error('评析失败:', error);
                errorMessage.textContent = `评析失败: ${error.message || '未知错误'}`;
                errorMessage.style.display = 'block';
            } finally {
                loadingSpinner.style.display = 'none'; // Hide loading spinner
                submitBtn.disabled = false; // Re-enable button
            }
        }

        // Event Listeners
        submitBtn.addEventListener('click', rateText);
        darkModeToggle.addEventListener('click', toggleDarkMode);

        // Color swatch click listeners
        colorSwatches.forEach(swatch => {
            swatch.addEventListener('click', () => {
                currentBaseTheme = swatch.dataset.theme;
                localStorage.setItem('selectedTheme', currentBaseTheme);
                applyTheme(document.body.classList.contains('dark-mode')); // Re-apply theme with new base color
            });
        });

        // Strict mode toggle listener
        strictModeToggle.addEventListener('change', () => {
            localStorage.setItem('strictMode', strictModeToggle.checked);
        });

        // Initialize theme and dark mode on page load
        document.addEventListener('DOMContentLoaded', initializeThemeAndDarkMode);
    </script>
</body>
</html>
